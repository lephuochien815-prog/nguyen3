<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ngừ iu đít bự</title>
    
    <style>
        /* Reset và base styles */
   

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000000;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'SF Pro Display', 'Segoe UI', sans-serif;
            color: #FFD700;
             cursor: url("image/chuot.png"), auto;
        }

        /* Password Screen */
        #password-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100000;
            text-align: center;
            transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .password-message {
            font-size: clamp(1.5rem, 4vw, 2rem);
            margin-bottom: 30px;
            color: #FFD700;
            font-weight: 400;
            letter-spacing: -0.5px;
            line-height: 1.3;
        }

        .password-input-container {
            position: relative;
            margin-bottom: 30px;
            width: 300px;
            max-width: 80%;
        }

        #password-input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            color: #FFD700;
            font-size: 1.1rem;
            text-align: center;
            letter-spacing: 2px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            outline: none;
        }

        #password-input:focus {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.6);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
        }

        #password-input::placeholder {
            color: rgba(255, 215, 0, 0.5);
            letter-spacing: 0;
        }

        #password-submit {
            background: transparent;
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            padding: 16px 32px;
            font-size: 1.1rem;
            color: #FFD700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 0.5px;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            background: rgba(255, 215, 0, 0.05);
            font-weight: 500;
        }

        #password-submit:hover, #password-submit:active {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.6);
            transform: scale(1.05);
        }

        .password-hint {
            font-size: 0.9rem;
            color: rgba(255, 215, 0, 0.5);
            margin-top: 15px;
            font-style: italic;
        }

        .password-error {
            color: #ff6b6b;
            font-size: 0.9rem;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .password-error.show {
            opacity: 1;
        }

        /* Close Button */
        .close-x-btn {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            color: #FFD700;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100001;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .close-x-btn:hover, .close-x-btn:active {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.1) rotate(90deg);
        }

        /* Intro Screen - Apple Style */
        #intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 99999;
            text-align: center;
            transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .intro-message {
            font-size: clamp(2rem, 5vw, 2.8rem);
            margin-bottom: 40px;
            color: #FFD700;
            font-weight: 400;
            letter-spacing: -0.5px;
            line-height: 1.2;
        }

        .intro-message span {
            font-weight: 600;
            color: #FFD700;
            background: linear-gradient(45deg, #FFD700, #FFED99);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        #start-btn {
            background: transparent;
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            padding: 16px 32px;
            font-size: 1.1rem;
            color: #FFD700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 0.5px;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            background: rgba(255, 215, 0, 0.05);
            font-weight: 500;
        }

        #start-btn:hover, #start-btn:active {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.6);
            transform: scale(1.05);
        }

        /* Countdown Container */
        #countdown-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 99998;
        }

        .countdown-number {
            position: absolute;
            font-size: clamp(8rem, 25vw, 15rem);
            font-weight: 300;
            color: #FFD700;
            opacity: 0;
            z-index: 99999;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 20px;
        }

        /* Certificate Container */
        #certificate-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 99997;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #certificate-container.show {
            opacity: 1;
        }

        #certificate {
            max-width: 90%;
            max-height: 80%;
            border: 2px solid #FFD700;
            box-shadow: 
                0 0 60px rgba(255, 215, 0, 0.3),
                0 20px 40px rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            animation: floatCertificate 4s ease-in-out infinite;
            transform-style: preserve-3d;
        }

        @keyframes floatCertificate {
            0%, 100% { 
                transform: translateY(0px) rotateX(0deg) rotateY(0deg); 
            }
            25% { 
                transform: translateY(-15px) rotateX(1deg) rotateY(0.5deg); 
            }
            75% { 
                transform: translateY(8px) rotateX(-0.5deg) rotateY(-0.3deg); 
            }
        }

        /* Letter Container */
        #letter-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 99996;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #letter-container.show {
            opacity: 1;
        }

        .letter-content {
            width: 90%;
            max-width: 800px;
            height: 80%;
            background: #1a1a1a;
            border: 2px solid #FFD700;
            border-radius: 20px;
            padding: 40px;
            overflow-y: auto;
            color: #FFD700;
            box-shadow: 
                0 0 60px rgba(255, 215, 0, 0.3),
                0 20px 40px rgba(0, 0, 0, 0.5);
            animation: floatCertificate 4s ease-in-out infinite;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .letter-header {
            text-align: center;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .letter-title {
            font-size: 2.5rem;
            font-weight: 600;
            color: #FFD700;
            margin-bottom: 10px;
        }

        .letter-date {
            font-size: 1rem;
            color: rgba(255, 215, 0, 0.7);
            font-style: italic;
        }

        .letter-body {
            font-size: 1.2rem;
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.9);
            flex-grow: 1;
            text-align: justify;
        }

        .letter-signature {
            text-align: right;
            font-size: 1.5rem;
            font-style: italic;
            color: #FFD700;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 215, 0, 0.3);
        }

        /* Fireworks Container */
        #fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99995;
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            pointer-events: none;
            background: #FFD700;
            opacity: 0;
        }

        /* Skip Certificate Button */
        #skip-certificate,
        #skip-letter {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: #FFD700;
            padding: 12px 24px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        #skip-certificate:hover, #skip-certificate:active,
        #skip-letter:hover, #skip-letter:active {
            background: rgba(255, 215, 0, 0.2);
            transform: translateX(-50%) scale(1.05);
        }

        /* Main App */
        #main-app {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            overflow: hidden;
            -webkit-overflow-scrolling: touch;
        }

        /* Floating Container với hiệu ứng 3D */
        #floating-container {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            perspective: 1000px;
            transform-style: preserve-3d;
        }

        /* Floating Image - APPLE STYLE với bo tròn */
        .floating-image {
            position: absolute;
            width: clamp(180px, 25vw, 220px);
            height: clamp(180px, 25vw, 220px);
            cursor: pointer;
            pointer-events: auto;
            border-radius: 24px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10;
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.1);
            box-shadow: 
                0 4px 6px -1px rgba(0, 0, 0, 0.1),
                0 2px 4px -1px rgba(0, 0, 0, 0.06),
                0 0 0 1px rgba(255, 215, 0, 0.05);
            animation: appleFloat 4s ease-in-out infinite;
            transform-style: preserve-3d;
            -webkit-touch-callout: none;
            -webkit-user-drag: element;
        }

        /* Special style for letter image */
        .floating-image.letter {
            animation: letterFloat 3s ease-in-out infinite;
            border-color: rgba(255, 86, 86, 0.3);
            box-shadow: 
                0 4px 6px -1px rgba(0, 0, 0, 0.1),
                0 2px 4px -1px rgba(0, 0, 0, 0.06),
                0 0 0 2px rgba(255, 86, 86, 0.2);
        }

        @keyframes letterFloat {
            0%, 100% { 
                transform: translateY(0px) rotateX(0deg) rotateY(0deg); 
            }
            33% { 
                transform: translateY(-15px) rotateX(3deg) rotateY(2deg); 
            }
            66% { 
                transform: translateY(10px) rotateX(-2deg) rotateY(-1deg); 
            }
        }

        .floating-image.letter:hover {
            animation: letterDance 0.8s ease-out forwards;
            transform: scale(1.2) !important;
            z-index: 1000;
            border-color: rgba(255, 86, 86, 0.5);
            box-shadow: 
                0 25px 50px -12px rgba(255, 86, 86, 0.4),
                0 0 0 3px rgba(255, 86, 86, 0.3);
        }

        @keyframes letterDance {
            0% { transform: translate(0, 0) scale(1.2); }
            25% { transform: translate(30px, -20px) scale(1.2); }
            50% { transform: translate(-25px, 15px) scale(1.2); }
            75% { transform: translate(20px, -10px) scale(1.2); }
            100% { transform: translate(0, 0) scale(1.2); }
        }

        @keyframes appleFloat {
            0%, 100% { 
                transform: translateY(0px) rotateX(0deg) rotateY(0deg); 
                box-shadow: 
                    0 4px 6px -1px rgba(0, 0, 0, 0.1),
                    0 2px 4px -1px rgba(0, 0, 0, 0.06),
                    0 0 0 1px rgba(255, 215, 0, 0.05);
            }
            50% { 
                transform: translateY(-12px) rotateX(2deg) rotateY(1deg); 
                box-shadow: 
                    0 20px 25px -5px rgba(255, 215, 0, 0.1),
                    0 10px 10px -5px rgba(255, 215, 0, 0.04),
                    0 0 0 1px rgba(255, 215, 0, 0.1);
            }
        }

        @media (hover: hover) {
            .floating-image:hover:not(.letter) {
                transform: scale(1.15) translateY(-5px) !important;
                z-index: 1000;
                border-color: rgba(255, 215, 0, 0.3);
                box-shadow: 
                    0 25px 50px -12px rgba(255, 215, 0, 0.25),
                    0 0 0 1px rgba(255, 215, 0, 0.2);
                animation-play-state: paused;
            }
        }

        .floating-image.active:not(.letter) {
            transform: scale(1.15) translateY(-5px) !important;
            z-index: 1000;
            border-color: rgba(255, 215, 0, 0.3);
            box-shadow: 
                0 25px 50px -12px rgba(255, 215, 0, 0.25),
                0 0 0 1px rgba(255, 215, 0, 0.2);
            animation-play-state: paused;
        }

        .floating-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 20px;
        }

        .floating-image:hover img,
        .floating-image.active img {
            transform: scale(1.08);
        }

        /* Back Button */
        #back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            color: #FFD700;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 999;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: none;
        }

        #back-button:hover, #back-button:active {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.1);
        }

        /* Selected View - Modal kiểu Apple */
        #selected-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            opacity: 0;
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #selected-container.show {
            opacity: 1;
        }

        .selected-content {
            display: flex;
            width: 90%;
            height: 85%;
            max-width: 1200px;
            gap: 40px;
            transform: translateY(20px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 20px;
        }

        #selected-container.show .selected-content {
            transform: translateY(0);
        }

        .selected-image {
            flex: 1.2;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 0;
        }

        .selected-image img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 28px;
            object-fit: contain;
            box-shadow: 
                0 20px 25px -5px rgba(0, 0, 0, 0.3),
                0 10px 10px -5px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.2);
            animation: modalFloat 6s ease-in-out infinite;
        }

        @keyframes modalFloat {
            0%, 100% { 
                transform: translateY(0px) scale(1); 
            }
            50% { 
                transform: translateY(-10px) scale(1.01); 
            }
        }

        /* Close Button - Apple Style */
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            color: #FFD700;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2001;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .close-btn:hover, .close-btn:active {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.1) rotate(90deg);
        }

        /* Navigation Arrows */
        .nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            color: #FFD700;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2002;
            opacity: 0.8;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .nav-arrow:hover, .nav-arrow:active {
            background: rgba(255, 215, 0, 0.2);
            opacity: 1;
            transform: translateY(-50%) scale(1.1);
        }

        #prev-arrow {
            left: 20px;
        }

        #next-arrow {
            right: 20px;
        }

        /* Current Indicator */
        .current-indicator {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #FFD700;
            font-size: 0.9rem;
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            z-index: 100;
            font-weight: 500;
            letter-spacing: 0.5px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            color: #FFD700;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 999;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        #audio-control:hover, #audio-control:active {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.1);
        }

        /* Instruction */
        .instruction {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 215, 0, 0.6);
            font-size: 0.8rem;
            padding: 10px 20px;
            border-radius: 20px;
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.1);
            text-align: center;
            z-index: 100;
            font-weight: 400;
            letter-spacing: 0.5px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            animation: instructionFloat 3s ease-in-out infinite;
        }

        @keyframes instructionFloat {
            0%, 100% { 
                transform: translateX(-50%) translateY(0px); 
            }
            50% { 
                transform: translateX(-50%) translateY(-5px); 
            }
        }

        /* Letter Catch Counter */
        .letter-catch-counter {
            position: fixed;
            height:10px;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 86, 86, 0.8);
            font-size: 0.9rem;
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(255, 86, 86, 0.1);
            border: 1px solid rgba(255, 86, 86, 0.2);
            z-index: 100;
            font-weight: 500;
            letter-spacing: 0.5px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: none;
        }

        /* Phản hồi chạm cho mobile */
        @media (max-width: 768px) {
            .floating-image {
                width: clamp(150px, 40vw, 180px);
                height: clamp(150px, 40vw, 180px);
                border-radius: 20px;
            }

            .letter-content {
                padding: 20px;
                height: 85%;
            }

            .letter-title {
                font-size: 1.8rem;
            }

            .letter-body {
                font-size: 1rem;
                line-height: 1.6;
            }

            .letter-signature {
                font-size: 1.2rem;
            }

            #certificate {
                max-width: 95%;
                max-height: 70%;
            }

            #skip-certificate,
            #skip-letter {
                bottom: 20px;
                padding: 10px 20px;
                font-size: 0.8rem;
            }

            .close-x-btn {
                top: 20px;
                right: 20px;
                width: 40px;
                height: 40px;
                font-size: 1.3rem;
            }

            .password-input-container {
                width: 250px;
            }

            #password-input {
                padding: 14px 18px;
                font-size: 1rem;
            }

            #password-submit {
                padding: 14px 28px;
                font-size: 1rem;
            }

            #back-button {
                top: 15px;
                left: 15px;
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }

            .letter-catch-counter {
                top: 70px;
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }

        /* Status Bar cho mobile */
        @supports (padding-top: env(safe-area-inset-top)) {
            #audio-control, .close-btn, .current-indicator,
            .close-x-btn, #back-button {
                top: max(20px, env(safe-area-inset-top));
            }
            
            .instruction, .letter-catch-counter {
                bottom: max(20px, env(safe-area-inset-bottom));
            }
            
            .letter-catch-counter {
                top: max(80px, env(safe-area-inset-top) + 60px);
            }
            
            #skip-certificate,
            #skip-letter {
                bottom: max(40px, env(safe-area-inset-bottom) + 20px);
            }
        }

        /* Hiệu ứng ripple khi chạm */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 215, 0, 0.3);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }

        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Password Screen -->
    <div id="password-screen">
        <button class="close-x-btn" id="close-x-btn">✕</button>
        <div class="password-message">Nhập mật khẩu để tiếp tục</div>
        <div class="password-input-container">
            <input type="password" id="password-input" placeholder="Nhập mật khẩu...">
        </div>
        <button id="password-submit">Xác nhận</button>
        <div class="password-hint">Gợi ý: ngày đặc biệt (dd/mm)</div>
        <div class="password-error" id="password-error">Mật khẩu không đúng!</div>
    </div>

    <!-- Audio -->
    <audio id="background-music" preload="auto" loop>
        <source src="audio/Download.mp3" type="audio/mpeg">
        <source src="audio/xinloi.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Audio cho giấy khen -->
    <audio id="celebration-audio" preload="auto">
        <source src="audio/audio.mp3" type="audio/mpeg">
    </audio>

    <!-- Audio cho lá thư -->
    <audio id="letter-audio" preload="auto" loop>
        <source src="audio/xinloi.mp3" type="audio/mpeg">
    </audio>

    <!-- Audio Control -->
    <button id="audio-control">♫</button>

    <!-- Back Button -->
    <button id="back-button">←</button>

    <!-- Letter Catch Counter -->
    <div class="letter-catch-counter" id="letter-catch-counter">
        Bắt được lá thư: <span id="catch-count">0</span>/3
    </div>

    <!-- Intro Screen -->
    <div id="intro-screen">
        <div class="intro-message">Chào <span>em bé của anh</span>,<br>chúng ta bắt đầu nhé</div>
        <button id="start-btn">Bắt Đầu</button>
    </div>

    <!-- Countdown -->
    <div id="countdown-container">
        <div id="countdown-number" class="countdown-number"></div>
    </div>

    <!-- Certificate Container -->
    <div id="certificate-container">
        <img id="certificate" src="" alt="Giấy khen">
        <button id="skip-certificate">Tiếp tục</button>
    </div>

    <!-- Letter Container -->
    <div id="letter-container">
        <div class="letter-content">
            <div class="letter-header">
                <div class="letter-title">Em muốn nói</div>
                <div class="letter-date">Bé có nhớ anh không</div>
            </div>
            <div class="letter-body">
                <p> Gưi em bé iu dấu của anh </p>
                <p> Anh đây Hiền nè</p>
                <p>Vậy là đây là Va len tai đầu tiên mà anh với em có bên nhau.Cảm ơn em vì đã đến đã ở lại và đã luôn dịu dàng với anh. Cảm ơn những lần em kiên nhẫn lắng nghe, những lần em hun anh chụt chụt làm mọi mệt mỏi trong anh tan biến đi hết. Ở bên em, anh học được cách quan tâm nhiều hơn,biết được nhiều chỗ hơn mà quan trọng anh còn biết được thêm được một con người luôn iu thương và quan tâm anh.

Anh không hứa những điều quá xa vời. Anh chỉ mong mỗi ngày trôi qua, dù là ngày nắng hay ngày mưa chúng ta vẫn chọn nắm tay nhau mà bước tiếp. Nếu có lúc anh chưa đủ tinh tế, chưa đủ hoàn hảo, mong em tin rằng tình cảm anh dành cho em luôn là thật lòng và nghiêm túc.

Chúc cho Valentine này không chỉ là một ngày có hoa và quà, mà là một kỷ niệm ấm áp để sau này mình nhớ lại và mỉm cười.

Thương em rất nhiều.</p>
            </div>
            <div class="letter-signature">Với tất cả tình yêu,<br>Người yêu em</div>
        </div>
        <button id="skip-letter">Quay lại</button>
    </div>

    <!-- Fireworks Container -->
    <div id="fireworks-container"></div>

    <!-- Main App -->
    <div id="main-app">
        <div id="floating-container"></div>
        
        <!-- Instruction -->
        <div class="instruction">Chạm vào ảnh để xem chi tiết • Kéo thả để di chuyển</div>
        
        <!-- Selected View -->
        <div id="selected-container">
            <div class="selected-content">
                <div class="selected-image">
                    <img id="selected-img" src="" alt="Selected Image">
                </div>
                <div class="selected-details"></div>
            </div>
            
            <button class="close-btn" id="close-btn">✕</button>
            <button class="nav-arrow" id="prev-arrow">‹</button>
            <button class="nav-arrow" id="next-arrow">›</button>
            <div class="current-indicator" id="current-indicator">1 / 10</div>
        </div>
    </div>

    <script>
        // ================== PASSWORD SETUP ==================
        const CORRECT_PASSWORD = "21/1"; // Mật khẩu là 21/1

        // ================== DOM ELEMENTS ==================
        const passwordScreen = document.getElementById('password-screen');
        const passwordInput = document.getElementById('password-input');
        const passwordSubmit = document.getElementById('password-submit');
        const passwordError = document.getElementById('password-error');
        const closeXBtn = document.getElementById('close-x-btn');
        const introScreen = document.getElementById('intro-screen');
        const startBtn = document.getElementById('start-btn');
        const countdownContainer = document.getElementById('countdown-container');
        const countdownNumber = document.getElementById('countdown-number');
        const certificateContainer = document.getElementById('certificate-container');
        const certificateImg = document.getElementById('certificate');
        const skipCertificateBtn = document.getElementById('skip-certificate');
        const letterContainer = document.getElementById('letter-container');
        const skipLetterBtn = document.getElementById('skip-letter');
        const fireworksContainer = document.getElementById('fireworks-container');
        const mainApp = document.getElementById('main-app');
        const floatingContainer = document.getElementById('floating-container');
        const selectedContainer = document.getElementById('selected-container');
        const selectedImg = document.getElementById('selected-img');
        const selectedDetails = document.querySelector('.selected-details');
        const closeBtn = document.getElementById('close-btn');
        const prevArrow = document.getElementById('prev-arrow');
        const nextArrow = document.getElementById('next-arrow');
        const currentIndicator = document.getElementById('current-indicator');
        const audioControl = document.getElementById('audio-control');
        const backgroundMusic = document.getElementById('background-music');
        const celebrationAudio = document.getElementById('celebration-audio');
        const letterAudio = document.getElementById('letter-audio');
        const instruction = document.querySelector('.instruction');
        const backButton = document.getElementById('back-button');
        const letterCatchCounter = document.getElementById('letter-catch-counter');
        const catchCount = document.getElementById('catch-count');

        // ================== STATE VARIABLES ==================
        let currentSelectedIndex = 0;
        let floatingImages = [];
        let isDragging = false;
        let dragImage = null;
        let dragOffset = { x: 0, y: 0 };
        let isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        let isMusicPlaying = true;
        let touchStartTime = 0;
        let longPressTimer = null;
        let letterElement = null;
        let letterCatchAttempts = 0;
        const LETTER_CATCH_REQUIRED = 3;
        let letterEscaping = false;
        let mouseX = 0;
        let mouseY = 0;

        // ================== PASSWORD FUNCTIONS ==================
        function checkPassword() {
            const enteredPassword = passwordInput.value.trim();
            
            if (enteredPassword === CORRECT_PASSWORD) {
                passwordError.classList.remove('show');
                passwordInput.value = '';
                
                // Chuyển sang intro screen
                passwordScreen.style.opacity = '0';
                setTimeout(() => {
                    passwordScreen.style.display = 'none';
                    introScreen.style.display = 'flex';
                    setTimeout(() => {
                        introScreen.style.opacity = '1';
                    }, 10);
                }, 600);
            } else {
                passwordError.classList.add('show');
                passwordInput.value = '';
                passwordInput.focus();
                
                // Hiệu ứng shake
                passwordInput.style.animation = 'none';
                setTimeout(() => {
                    passwordInput.style.animation = 'shake 0.5s';
                }, 10);
                
                setTimeout(() => {
                    passwordInput.style.animation = '';
                }, 500);
            }
        }

        // ================== CLOSE X BUTTON ==================
        function showExitConfirmation() {
            if (confirm('Bạn có muốn thoát khỏi trang web này không?')) {
                window.close();
                
                // Fallback cho trình duyệt không cho phép đóng tự động
                if (!window.closed) {
                    window.location.href = 'about:blank';
                }
            }
        }

        // ================== EVENT LISTENERS ==================
        // Password submit
        passwordSubmit.addEventListener('click', checkPassword);
        passwordSubmit.addEventListener('touchstart', (e) => {
            e.preventDefault();
            checkPassword();
        });

        // Enter key for password
        passwordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });

        // Close X button
        closeXBtn.addEventListener('click', showExitConfirmation);
        closeXBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            showExitConfirmation();
        });

        // Back button
        backButton.addEventListener('click', showMainView);
        backButton.addEventListener('touchstart', (e) => {
            e.preventDefault();
            showMainView();
        });

        // Track mouse position for letter escape
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            
            if (letterElement && !letterEscaping) {
                checkLetterEscape(e.clientX, e.clientY);
            }
        });

        // Touch move for mobile
        document.addEventListener('touchmove', (e) => {
            if (letterElement && !letterEscaping) {
                const touch = e.touches[0];
                mouseX = touch.clientX;
                mouseY = touch.clientY;
                checkLetterEscape(touch.clientX, touch.clientY);
            }
        });

        // Focus password input on load
        window.addEventListener('DOMContentLoaded', () => {
            passwordInput.focus();
            
            // Thêm CSS cho hiệu ứng shake
            const style = document.createElement('style');
            style.textContent = `
                @keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                    20%, 40%, 60%, 80% { transform: translateX(5px); }
                }
            `;
            document.head.appendChild(style);
            
            // Thiết lập audio
            backgroundMusic.volume = 0.6;
            backgroundMusic.loop = true;
            letterAudio.volume = 0.7;
            
            // Load cả hai bài hát
            const sources = [
                { src: 'audio/Download.mp3', type: 'audio/mpeg' },
                { src: 'audio/xinloi.mp3', type: 'audio/mpeg' }
            ];
            
            // Thêm các source vào audio element
            backgroundMusic.innerHTML = '';
            sources.forEach(source => {
                const sourceElement = document.createElement('source');
                sourceElement.src = source.src;
                sourceElement.type = source.type;
                backgroundMusic.appendChild(sourceElement);
            });
            
            // Thử phát nhạc (cần user interaction)
            backgroundMusic.load();
        });

        // ================== AUDIO CONTROL ==================
        audioControl.addEventListener('click', toggleMusic);
        audioControl.addEventListener('touchstart', (e) => {
            e.preventDefault();
            toggleMusic();
        });

        function toggleMusic() {
            if (isMusicPlaying) {
                backgroundMusic.pause();
                isMusicPlaying = false;
                audioControl.textContent = '♪';
                audioControl.style.opacity = '0.6';
            } else {
                backgroundMusic.play().catch(console.log);
                isMusicPlaying = true;
                audioControl.textContent = '♫';
                audioControl.style.opacity = '1';
            }
        }

        // ================== INTRO ==================
        startBtn.addEventListener('click', startApp);
        startBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            startApp();
        });

        function startApp() {
            introScreen.style.opacity = '0';
            
            if (backgroundMusic.paused) {
                backgroundMusic.play().catch(console.log);
            }
            
            setTimeout(() => {
                introScreen.style.display = 'none';
                startCountdown();
            }, 600);
        }

        // ================== COUNTDOWN ==================
        function startCountdown() {
            countdownContainer.style.display = 'flex';
            
            let count = 3;
            
            function showNumber(num) {
                countdownNumber.textContent = num;
                countdownNumber.style.opacity = '1';
                countdownNumber.style.transform = 'scale(1)';
                
                setTimeout(() => {
                    countdownNumber.style.opacity = '0';
                    countdownNumber.style.transform = 'scale(0.5)';
                    
                    if (num > 1) {
                        setTimeout(() => {
                            showNumber(num - 1);
                        }, 300);
                    } else {
                        setTimeout(() => {
                            endCountdown();
                        }, 500);
                    }
                }, 700);
            }
            
            showNumber(3);
        }

        function endCountdown() {
            countdownContainer.style.display = 'none';
            showCertificate();
        }

        // ================== CERTIFICATE ==================
        function showCertificate() {
            // Load hình giấy khen
            certificateImg.src = 'image/giaykhen.png';
            certificateImg.onerror = createDefaultCertificate;
            
            certificateContainer.style.display = 'flex';
            setTimeout(() => {
                certificateContainer.classList.add('show');
            }, 10);
            
            // Phát nhạc chúc mừng
            celebrationAudio.volume = 0.8;
            celebrationAudio.play().catch(console.log);
            
            // Bắn pháo hoa
            startFireworks();
            
            // Tự động chuyển sau 15 giây
            setTimeout(() => {
                if (certificateContainer.style.display === 'flex') {
                    endCertificate();
                }
            }, 15000);
            
            // Sự kiện cho nút skip
            skipCertificateBtn.addEventListener('click', endCertificate);
            skipCertificateBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                endCertificate();
            });
        }

        function createDefaultCertificate() {
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 600;
            const ctx = canvas.getContext('2d');
            
            // Black background
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, 800, 600);
            
            // Gold border
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 3;
            ctx.strokeRect(30, 30, 740, 540);
            
            // Inner border
            ctx.strokeStyle = 'rgba(255, 215, 0, 0.5)';
            ctx.lineWidth = 1;
            ctx.strokeRect(40, 40, 720, 520);
            
            // Title
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 60px "Times New Roman", serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('GIẤY KHEN', 400, 120);
            
            // Decorative line
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(150, 140);
            ctx.lineTo(300, 140);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(500, 140);
            ctx.lineTo(650, 140);
            ctx.stroke();
            
            // Content
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'italic 32px "Georgia", serif';
            ctx.fillText('Dành tặng em bé yêu dấu', 400, 220);
            
            ctx.font = '28px "Georgia", serif';
            ctx.fillText('Người đã mang đến hạnh phúc', 400, 280);
            ctx.fillText('và ý nghĩa cho cuộc sống của anh', 400, 320);
            
            // Heart
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 80px Arial';
            ctx.fillText('❤', 400, 400);
            
            // Signature
            ctx.font = 'italic 36px "Brush Script MT", cursive';
            ctx.fillText('Với tất cả tình yêu', 400, 480);
            
            ctx.font = 'bold 48px "Brush Script MT", cursive';
            ctx.fillText('IU NGUYÊN', 400, 540);
            
            certificateImg.src = canvas.toDataURL();
        }

        function endCertificate() {
            celebrationAudio.pause();
            celebrationAudio.currentTime = 0;
            
            certificateContainer.classList.remove('show');
            setTimeout(() => {
                certificateContainer.style.display = 'none';
                fireworksContainer.innerHTML = '';
                
                // Hiển thị app chính
                mainApp.style.display = 'block';
                initFloatingImages();
                
                // Ẩn instruction sau 5 giây
                setTimeout(() => {
                    instruction.style.opacity = '0';
                    setTimeout(() => instruction.style.display = 'none', 300);
                }, 5000);
            }, 500);
        }

        // ================== LETTER FUNCTIONS ==================
        function showLetter() {
            // Hiển thị lá thư
            letterContainer.style.display = 'flex';
            setTimeout(() => {
                letterContainer.classList.add('show');
            }, 10);
            
            // Phát nhạc xinloi.mp3
            backgroundMusic.pause();
            letterAudio.currentTime = 0;
            letterAudio.play().catch(console.log);
            
            // Sự kiện cho nút skip
            skipLetterBtn.addEventListener('click', closeLetter);
            skipLetterBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                closeLetter();
            });
        }

        function closeLetter() {
            // Dừng nhạc lá thư
            letterAudio.pause();
            letterAudio.currentTime = 0;
            
            // Tiếp tục nhạc nền
            if (isMusicPlaying) {
                backgroundMusic.play().catch(console.log);
            }
            
            letterContainer.classList.remove('show');
            setTimeout(() => {
                letterContainer.style.display = 'none';
                showMainView();
            }, 500);
            
            // Reset counter
            letterCatchAttempts = 0;
            catchCount.textContent = '0';
            letterCatchCounter.style.display = 'none';
        }

        function checkLetterEscape(clientX, clientY) {
            if (!letterElement || letterEscaping) return;
            
            const rect = letterElement.getBoundingClientRect();
            const letterCenterX = rect.left + rect.width / 2;
            const letterCenterY = rect.top + rect.height / 2;
            
            const distance = Math.sqrt(
                Math.pow(clientX - letterCenterX, 2) + 
                Math.pow(clientY - letterCenterY, 2)
            );
            
            // Nếu chuột đến gần lá thư (trong vòng 150px)
            if (distance < 150) {
                escapeLetter();
            }
        }

        function escapeLetter() {
            if (!letterElement || letterEscaping) return;
            
            letterEscaping = true;
            
            // Hiệu ứng nhảy
            letterElement.style.animation = 'letterDance 0.8s ease-out forwards';
            
            // Sau khi nhảy xong, di chuyển đến vị trí mới
            setTimeout(() => {
                const margin = 15;
                const newX = margin + Math.random() * (100 - 2 * margin);
                const newY = margin + Math.random() * (100 - 2 * margin);
                
                letterElement.style.left = `${newX}%`;
                letterElement.style.top = `${newY}%`;
                letterElement.style.animation = 'letterFloat 3s ease-in-out infinite';
                
                // Tăng counter
                letterCatchAttempts++;
                catchCount.textContent = letterCatchAttempts;
                
                // Hiển thị counter nếu chưa
                if (letterCatchAttempts === 1) {
                    letterCatchCounter.style.display = 'block';
                    letterCatchCounter.style.animation = 'none';
                    setTimeout(() => {
                        letterCatchCounter.style.animation = 'instructionFloat 3s ease-in-out infinite';
                    }, 10);
                }
                
                // Hiệu ứng đếm
                letterCatchCounter.style.transform = 'translateX(-50%) scale(1.1)';
                setTimeout(() => {
                    letterCatchCounter.style.transform = 'translateX(-50%) scale(1)';
                }, 300);
                
                // Nếu đã bắt được 3 lần, mở lá thư
                if (letterCatchAttempts >= LETTER_CATCH_REQUIRED) {
                    setTimeout(() => {
                        showLetter();
                    }, 500);
                }
                
                letterEscaping = false;
            }, 800);
        }

        // ================== MAIN VIEW FUNCTIONS ==================
        function showMainView() {
            // Hiển thị nút back
            backButton.style.display = 'none';
            
            // Hiển thị tất cả floating images
            floatingImages.forEach(img => {
                img.element.style.display = 'block';
            });
            
            // Ẩn selected view
            selectedContainer.classList.remove('show');
            setTimeout(() => {
                selectedContainer.style.display = 'none';
                document.body.style.overflow = '';
            }, 300);
        }

        // ================== FLOATING IMAGES WITH DRAG & DROP ==================
        function initFloatingImages() {
            floatingContainer.innerHTML = '';
            floatingImages = [];
            letterElement = null;
            letterCatchAttempts = 0;

            const ALBUM_IMAGES = [
                { image: 'image/image1.png' },
                { image: 'image/image2.png' },
                { image: 'image/image3.png' },
                { image: 'image/image4.png' },
                { image: 'image/image5.png' },
                { image: 'image/image6.png' },
                { image: 'image/image7.png' },
                { image: 'image/image8.png' },
                { image: 'image/image9.png' },
                { image: 'image/image10.png' },
                { 
                    image: 'letter-icon.png',
                    isLetter: true 
                }
            ];

            ALBUM_IMAGES.forEach((item, index) => {
                const floatingDiv = document.createElement('div');
                floatingDiv.className = 'floating-image';
                if (item.isLetter) {
                    floatingDiv.classList.add('letter');
                }
                floatingDiv.dataset.index = index;
                
                floatingDiv.style.animationDelay = `${index * 0.2}s`;
                
                const img = document.createElement('img');
                if (item.isLetter) {
                    // Nếu là lá thư, sử dụng icon đặc biệt
                    img.src = item.image || createLetterIcon();
                    img.alt = 'Lá thư';
                } else {
                    img.src = item.image;
                    img.alt = 'Kỷ niệm';
                }
                img.draggable = false;
                img.onerror = function() {
                    if (item.isLetter) {
                        this.src = createLetterIcon();
                    } else {
                        this.src = createPlaceholderImage('Kỷ niệm');
                    }
                };
                
                floatingDiv.appendChild(img);
                
                // Click/tap event
                floatingDiv.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (!item.isLetter) {
                        selectImage(index);
                    }
                });
                
                // Touch events
                floatingDiv.addEventListener('touchstart', handleTouchStart);
                floatingDiv.addEventListener('touchmove', handleTouchMove);
                floatingDiv.addEventListener('touchend', handleTouchEnd);
                
                // Mouse events
                floatingDiv.addEventListener('mousedown', handleMouseDown);
                floatingDiv.addEventListener('mouseenter', () => {
                    if (!isMobile && !item.isLetter) floatingDiv.classList.add('active');
                });
                floatingDiv.addEventListener('mouseleave', () => {
                    if (!isMobile && !item.isLetter) floatingDiv.classList.remove('active');
                });
                
                floatingContainer.appendChild(floatingDiv);
                
                // Random position
                const margin = 15;
                const x = margin + Math.random() * (100 - 2 * margin);
                const y = margin + Math.random() * (100 - 2 * margin);
                
                floatingImages.push({
                    element: floatingDiv,
                    x, y,
                    width: parseFloat(getComputedStyle(floatingDiv).width),
                    height: parseFloat(getComputedStyle(floatingDiv).height),
                    isDragging: false,
                    isLetter: item.isLetter
                });
                
                floatingDiv.style.left = `${x}%`;
                floatingDiv.style.top = `${y}%`;
                
                // Lưu reference đến lá thư
                if (item.isLetter) {
                    letterElement = floatingDiv;
                }
            });
            
            // Modal events
            closeBtn.addEventListener('click', closeSelectedView);
            closeBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                closeSelectedView();
            });
            
            prevArrow.addEventListener('click', () => navigateImage(-1));
            prevArrow.addEventListener('touchstart', (e) => {
                e.preventDefault();
                navigateImage(-1);
            });
            
            nextArrow.addEventListener('click', () => navigateImage(1));
            nextArrow.addEventListener('touchstart', (e) => {
                e.preventDefault();
                navigateImage(1);
            });
            
            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (selectedContainer.classList.contains('show')) {
                    if (e.key === 'ArrowLeft') navigateImage(-1);
                    else if (e.key === 'ArrowRight') navigateImage(1);
                    else if (e.key === 'Escape' || e.key === ' ') closeSelectedView();
                }
            });
            
            // Start animation
            requestAnimationFrame(animateFloatingImages);
        }

        // ================== TOUCH HANDLERS ==================
        function handleTouchStart(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const touch = e.touches[0];
            const target = e.currentTarget;
            const index = parseInt(target.dataset.index);
            const ALBUM_IMAGES = getAlbumImages();
            const item = ALBUM_IMAGES[index];
            
            // Nếu là lá thư trên mobile, xử lý touch riêng
            if (item.isLetter) {
                letterCatchAttempts++;
                catchCount.textContent = letterCatchAttempts;
                
                // Hiển thị counter nếu chưa
                if (letterCatchAttempts === 1) {
                    letterCatchCounter.style.display = 'block';
                }
                
                // Hiệu ứng đếm
                letterCatchCounter.style.transform = 'translateX(-50%) scale(1.1)';
                setTimeout(() => {
                    letterCatchCounter.style.transform = 'translateX(-50%) scale(1)';
                }, 300);
                
                // Di chuyển lá thư
                const margin = 15;
                const newX = margin + Math.random() * (100 - 2 * margin);
                const newY = margin + Math.random() * (100 - 2 * margin);
                
                target.style.left = `${newX}%`;
                target.style.top = `${newY}%`;
                
                // Nếu đã bắt được 3 lần, mở lá thư
                if (letterCatchAttempts >= LETTER_CATCH_REQUIRED) {
                    setTimeout(() => {
                        showLetter();
                    }, 500);
                }
                return;
            }
            
            touchStartTime = Date.now();
            
            longPressTimer = setTimeout(() => {
                startDrag(target, touch.clientX, touch.clientY);
                target.classList.remove('active');
            }, 300);
            
            createRipple(target, touch.clientX, touch.clientY);
        }

        function handleTouchMove(e) {
            if (!isDragging) return;
            
            e.preventDefault();
            e.stopPropagation();
            
            const touch = e.touches[0];
            updateDragPosition(touch.clientX, touch.clientY);
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            e.stopPropagation();
            
            clearTimeout(longPressTimer);
            
            const target = e.currentTarget;
            const index = parseInt(target.dataset.index);
            const ALBUM_IMAGES = getAlbumImages();
            const item = ALBUM_IMAGES[index];
            
            if (Date.now() - touchStartTime < 300 && !isDragging && !item.isLetter) {
                selectImage(index);
            }
            
            if (isDragging) {
                endDrag();
            }
            
            target.classList.remove('active');
        }

        // ================== MOUSE HANDLERS ==================
        function handleMouseDown(e) {
            e.preventDefault();
            e.stopPropagation();
            
            if (e.button !== 0) return;
            
            const target = e.currentTarget;
            
            startDrag(target, e.clientX, e.clientY);
            
            createRipple(target, e.clientX, e.clientY);
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
        }

        function handleMouseMove(e) {
            if (!isDragging) return;
            updateDragPosition(e.clientX, e.clientY);
        }

        function handleMouseUp() {
            if (isDragging) {
                endDrag();
            }
            
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseUp);
        }

        // ================== DRAG & DROP FUNCTIONS ==================
        function startDrag(element, clientX, clientY) {
            isDragging = true;
            dragImage = element;
            
            const rect = element.getBoundingClientRect();
            dragOffset.x = clientX - rect.left;
            dragOffset.y = clientY - rect.top;
            
            element.style.zIndex = '1000';
            element.style.cursor = 'grabbing';
            element.style.transition = 'none';
            element.style.animationPlayState = 'paused';
            
            const dragIndex = floatingImages.findIndex(img => img.element === element);
            if (dragIndex !== -1) {
                floatingImages[dragIndex].isDragging = true;
            }
        }

        function updateDragPosition(clientX, clientY) {
            if (!dragImage || !isDragging) return;
            
            const containerRect = floatingContainer.getBoundingClientRect();
            
            const newX = ((clientX - dragOffset.x - containerRect.left) / containerRect.width) * 100;
            const newY = ((clientY - dragOffset.y - containerRect.top) / containerRect.height) * 100;
            
            const margin = 5;
            const clampedX = Math.max(margin, Math.min(newX, 100 - margin));
            const clampedY = Math.max(margin, Math.min(newY, 100 - margin));
            
            dragImage.style.left = `${clampedX}%`;
            dragImage.style.top = `${clampedY}%`;
            
            const dragIndex = floatingImages.findIndex(img => img.element === dragImage);
            if (dragIndex !== -1) {
                floatingImages[dragIndex].x = clampedX;
                floatingImages[dragIndex].y = clampedY;
            }
        }

        function endDrag() {
            if (!dragImage) return;
            
            isDragging = false;
            
            dragImage.style.zIndex = '10';
            dragImage.style.cursor = 'pointer';
            dragImage.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
            dragImage.style.animationPlayState = 'running';
            
            const dragIndex = floatingImages.findIndex(img => img.element === dragImage);
            if (dragIndex !== -1) {
                floatingImages[dragIndex].isDragging = false;
            }
            
            dragImage = null;
        }

        // ================== SELECT IMAGE ==================
        function selectImage(index) {
            currentSelectedIndex = index;
            
            const ALBUM_IMAGES = getAlbumImages();
            const item = ALBUM_IMAGES[index];
            
            selectedImg.style.opacity = '0';
            
            const img = new Image();
            img.onload = () => {
                selectedImg.src = item.image;
                selectedImg.style.opacity = '1';
            };
            img.onerror = () => {
                selectedImg.src = createPlaceholderImage('Kỷ niệm', true);
                selectedImg.style.opacity = '1';
            };
            img.src = item.image;
            
            // Xóa title và description
            selectedDetails.innerHTML = '';
            currentIndicator.textContent = `${index + 1} / ${ALBUM_IMAGES.length - 1}`;
            
            selectedContainer.style.display = 'flex';
            setTimeout(() => {
                selectedContainer.classList.add('show');
                document.body.style.overflow = 'hidden';
                
                // Hiển thị nút back
                backButton.style.display = 'flex';
                
                // Ẩn tất cả floating images
                floatingImages.forEach(img => {
                    img.element.style.display = 'none';
                });
            }, 10);
        }

        function navigateImage(direction) {
            let newIndex = currentSelectedIndex + direction;
            
            const ALBUM_IMAGES = getAlbumImages();
            
            // Bỏ qua lá thư khi navigation
            if (ALBUM_IMAGES[newIndex] && ALBUM_IMAGES[newIndex].isLetter) {
                newIndex += direction;
            }
            
            newIndex = (newIndex + ALBUM_IMAGES.length) % ALBUM_IMAGES.length;
            
            // Nếu lại gặp lá thư, tiếp tục bỏ qua
            if (ALBUM_IMAGES[newIndex] && ALBUM_IMAGES[newIndex].isLetter) {
                newIndex = (newIndex + direction + ALBUM_IMAGES.length) % ALBUM_IMAGES.length;
            }
            
            selectImage(newIndex);
        }

        function closeSelectedView() {
            showMainView();
        }

        // ================== FLOATING ANIMATION ==================
        function animateFloatingImages() {
            floatingImages.forEach((img, index) => {
                if (img.isDragging) return;
                
                const time = Date.now() * 0.001;
                const floatX = Math.sin(time + index * 0.5) * 0.3;
                const floatY = Math.cos(time + index * 0.3) * 0.5;
                
                const rotationX = Math.sin(time + index * 0.7) * 0.5;
                const rotationY = Math.cos(time + index * 0.4) * 0.3;
                
                // Nếu không phải lá thư, áp dụng animation bình thường
                if (!img.isLetter) {
                    img.element.style.transform = `translate(${floatX}px, ${floatY}px) rotateX(${rotationX}deg) rotateY(${rotationY}deg)`;
                }
                
                const centerX = 50;
                const centerY = 50;
                const distance = Math.sqrt(Math.pow(img.x - centerX, 2) + Math.pow(img.y - centerY, 2));
                const opacity = 0.7 + 0.3 * Math.max(0, 1 - distance / 40);
                img.element.style.opacity = opacity;
            });
            
            requestAnimationFrame(animateFloatingImages);
        }

        // ================== UTILITY FUNCTIONS ==================
        function getAlbumImages() {
            return [
                { image: 'image/image1.png' },
                { image: 'image/image2.png' },
                { image: 'image/image3.png' },
                { image: 'image/image4.png' },
                { image: 'image/image5.png' },
                { image: 'image/image6.png' },
                { image: 'image/image7.png' },
                { image: 'image/image8.png' },
                { image: 'image/image9.png' },
                { image: 'image/image10.png' },
                { 
                    image: 'letter-icon.png',
                    isLetter: true 
                }
            ];
        }

        function createRipple(element, x, y) {
            const ripple = document.createElement('span');
            ripple.className = 'ripple';
            
            const rect = element.getBoundingClientRect();
            ripple.style.left = `${x - rect.left}px`;
            ripple.style.top = `${y - rect.top}px`;
            
            element.appendChild(ripple);
            
            setTimeout(() => {
                ripple.remove();
            }, 600);
        }

        function createPlaceholderImage(title, large = false) {
            const width = large ? 800 : 400;
            const height = large ? 600 : 300;
            
            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            
            const gradient = ctx.createLinearGradient(0, 0, width, height);
            gradient.addColorStop(0, '#1a1a1a');
            gradient.addColorStop(1, '#0a0a0a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
            
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = large ? 4 : 2;
            ctx.strokeRect(20, 20, width - 40, height - 40);
            
            if (large) {
                ctx.lineWidth = 2;
                ctx.setLineDash([10, 5]);
                ctx.strokeRect(30, 30, width - 60, height - 60);
                ctx.setLineDash([]);
            }
            
            ctx.fillStyle = '#FFD700';
            ctx.font = `bold ${large ? '80' : '40'}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('📷', width/2, height/2 - (large ? 40 : 20));
            
            ctx.font = `${large ? 'bold 32px' : 'bold 16px'} -apple-system, sans-serif`;
            ctx.fillText(title, width/2, height/2 + (large ? 40 : 20));
            
            return canvas.toDataURL();
        }

        function createLetterIcon() {
            const canvas = document.createElement('canvas');
            canvas.width = 400;
            canvas.height = 300;
            const ctx = canvas.getContext('2d');
            
            // Background
            const gradient = ctx.createLinearGradient(0, 0, 400, 300);
            gradient.addColorStop(0, '#2a2a2a');
            gradient.addColorStop(1, '#1a1a1a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 400, 300);
            
            // Envelope shape
            ctx.strokeStyle = '#FF5555';
            ctx.lineWidth = 3;
            ctx.fillStyle = '#442222';
            
            // Envelope body
            ctx.beginPath();
            ctx.moveTo(50, 100);
            ctx.lineTo(350, 100);
            ctx.lineTo(200, 200);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Letter inside
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(80, 120, 240, 60);
            
            // Heart
            ctx.fillStyle = '#FF5555';
            ctx.font = 'bold 60px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('💌', 200, 150);
            
            // Text
            ctx.font = 'bold 24px Arial';
            ctx.fillStyle = '#FF5555';
            ctx.fillText('Lá Thư', 200, 230);
            
            return canvas.toDataURL();
        }

        // ================== FIREWORKS ==================
        function startFireworks() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => createFirework(), i * 200);
            }
            
            const fireworkInterval = setInterval(() => {
                if (certificateContainer.style.display === 'flex') {
                    createFirework();
                } else {
                    clearInterval(fireworkInterval);
                }
            }, 800);
        }

        function createFirework() {
            const firework = document.createElement('div');
            firework.className = 'firework';
            
            // Random position
            firework.style.left = Math.random() * 100 + '%';
            firework.style.top = Math.random() * 100 + '%';
            
            fireworksContainer.appendChild(firework);
            
            const size = 4 + Math.random() * 6;
            firework.style.width = size + 'px';
            firework.style.height = size + 'px';
            
            const particleCount = 30 + Math.floor(Math.random() * 40);
            const duration = 1000 + Math.random() * 800;
            
            // Launch firework
            firework.animate([
                { transform: 'scale(0.5)', opacity: 0 },
                { transform: 'scale(1.2)', opacity: 1 },
                { transform: 'scale(2)', opacity: 0.8 }
            ], {
                duration: duration * 0.3,
                easing: 'ease-out'
            }).onfinish = () => {
                // Create particles
                for (let i = 0; i < particleCount; i++) {
                    createFireworkParticle(
                        firework.style.left,
                        firework.style.top,
                        duration * 0.7
                    );
                }
                firework.remove();
            };
        }

        function createFireworkParticle(x, y, duration) {
            const particle = document.createElement('div');
            particle.className = 'firework';
            particle.style.left = x;
            particle.style.top = y;
            
            const size = 2 + Math.random() * 3;
            particle.style.width = size + 'px';
            particle.style.height = size + 'px';
            
            fireworksContainer.appendChild(particle);
            
            const angle = Math.random() * Math.PI * 2;
            const distance = 40 + Math.random() * 80;
            const targetX = Math.cos(angle) * distance;
            const targetY = Math.sin(angle) * distance;
            
            particle.animate([
                { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                { transform: `translate(${targetX}px, ${targetY}px) scale(0)`, opacity: 0 }
            ], {
                duration: duration,
                easing: 'cubic-bezier(0.2, 0, 0.8, 1)'
            }).onfinish = () => particle.remove();
        }

        // ================== RESIZE HANDLER ==================
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                floatingImages.forEach(img => {
                    img.element.style.left = `${img.x}%`;
                    img.element.style.top = `${img.y}%`;
                });
            }, 200);
        });

        // ================== FULLSCREEN ==================
        document.addEventListener('dblclick', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(console.log);
            } else if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        });

        // ================== ORIENTATION CHANGE ==================
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                location.reload();
            }, 100);
        });
    </script>
</body>
</html>s